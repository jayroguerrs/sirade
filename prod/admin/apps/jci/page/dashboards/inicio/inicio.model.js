"use strict";import{environment}from"../../../../../../../environment.js";var KTEvaluaciones=function(){var e,o,t,a;return $("#custom-pdf").on("click",(function(e){e.preventDefault(),a.button(".buttons-pdf").trigger()})),$("#custom-excel").on("click",(function(e){e.preventDefault(),a.button(".buttons-excel").trigger()})),$("#custom-csv").on("click",(function(e){e.preventDefault(),a.button(".buttons-csv").trigger()})),$("#custom-copy").on("click",(function(e){e.preventDefault(),a.button(".buttons-copy").trigger()})),{init:function(){t=document.getElementById("form_modal_agregar_periodos"),o=document.getElementById("kt_modal_agregar_periodos_submit"),document.getElementById("kt_modal_agregar_periodos_cancel"),fetch(`${environment.apiSRD}/API/jci/dashboard/resumen-evaluaciones`,{method:"POST",body:function(e){var o=ObtenerDatos();e.periodo=o.periodo,e.fecha=o.fecha,e.estado=o.estado,e.usuario=$("#session_usuario_id").val(),e.usuario_rol=$("#session_rol_id").val()}}).then((e=>e.json())).then((e=>{e.estado})),document.querySelector('[data-kt-periodos-table-filter="search"]').addEventListener("keyup",(function(e){a.search(e.target.value).draw()})),e=FormValidation.formValidation(t,{fields:{periodo:{validators:{notEmpty:{message:"El periodo es requerido"}}},fecha:{validators:{notEmpty:{message:"La fecha es requerida"}}},estado:{validators:{integer:{message:"El estado debe ser un valor válido"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),o.addEventListener("click",(r=>{r.preventDefault(),e&&e.validate().then((function(r){if("Valid"==r){o.setAttribute("data-kt-indicator","on"),o.disabled=!0;var n=new FormData(t);n.append("usuario",$("#session_usuario_id").val()),n.append("usuario_rol",$("#session_rol_id").val()),n.append("periodo",$('[name="periodo"]').val());var i="Agregar Periodo"==document.getElementById("titulo_modal").innerText?"agregar":"editar";Swal.fire({text:"¿Está seguro que desea guardar los cambios registrados?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Si, guardar",cancelButtonText:"No, cancelar",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then((function(o){o.value&&fetch(`${environment.apiSRD}/API/jci/periodos/${i}-periodo`,{method:"POST",body:n}).then((e=>e.json())).then((o=>{1==o.estado?("agregar"==i?swal.fire({text:"Se ha agregado el periodo correctamente",icon:"success",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn font-weight-bold btn-light-primary"}}):Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los cambios han sido guardados exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),$('[name="id"]').val(null).trigger("change"),$('[name="periodo"]').val(null).trigger("change"),$('[name="fecha"]').val(null).trigger("change"),document.querySelector('input[name="estado"][value="1"]').checked=!1,document.querySelector('input[name="estado"][value="0"]').checked=!1,e.resetForm(),a.ajax.reload(),$("#kt_modal_agregar_periodos").modal("hide")):Swal.fire({html:ErrorMensaje(o),icon:"error",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn btn-primary"}})}))})),o.setAttribute("data-kt-indicator","off"),o.disabled=!1}}))})),document.querySelector("#kt_modal_filtro_periodos_submit").addEventListener("click",(function(e){e.preventDefault(),$("#kt_modal_filtro_periodos").modal("hide"),a.ajax.reload(),Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los filtros se han aplicado exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})})),document.querySelector("#kt_modal_filtro_periodos_limpiar").addEventListener("click",(function(e){e.preventDefault(),document.getElementById("form_modal_filtro_periodos").reset(),$('[name="filtro-periodos"]').val(null).trigger("change"),$('[name="filtro-fecha"]').val(null).trigger("change"),$("form#form_modal_filtro_periodos [name=filtro-fecha]").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",locale:"es"}).setDate([null,null]),document.querySelector('input[name="filtro-estado"][value="1"]').checked=!1,document.querySelector('input[name="filtro-estado"][value="0"]').checked=!1,a.ajax.reload(),Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los filtros se han limpiado exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})})),$("#kt_modal_agregar_periodos").on("hidden.bs.modal",(function(){$('[name="id"]').val(null).trigger("change"),$('[name="periodo"]').val(null).trigger("change"),$("form#form_modal_agregar_periodos [name=fecha]").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",locale:"es"}).setDate([null,null]),document.querySelector('input[name="estado"][value="1"]').checked=!1,document.querySelector('input[name="estado"][value="0"]').checked=!1,e.resetForm()}))}}}();function AbrirModalPeriodo(e,o){if("editar"==o){document.getElementById("div-estado").style.display="block";var t=new FormData;t.append("usuario",$("#session_usuario_id").val()),t.append("usuario_rol",$("#session_rol_id").val()),t.append("id",e),fetch(`${environment.apiSRD}/API/jci/periodos/obtener-por-id`,{method:"POST",body:t}).then((e=>e.json())).then((e=>{if(1==e.estado){var o=e.data,t=$("form#form_modal_agregar_periodos [name=fecha]").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",locale:"es"});$('[name="id"]').val(o.id).trigger("change"),$('[name="periodo"]').val(o.periodo).trigger("change"),t.setDate([o.fecha_inicio,o.fecha_fin]),document.querySelector(`input[name="estado"][value="${o.estado}"]`).checked=!0}else Swal.fire({html:ErrorMensaje(e),icon:"error",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn btn-primary"}})})),document.getElementById("titulo_modal").innerText="Editar Periodo"}else document.getElementById("div-estado").style.display="none",document.getElementById("titulo_modal").innerText="Agregar Periodo";$("#kt_modal_agregar_periodos").modal("show")}function EliminarPeriodo(e){var o=new FormData;o.append("usuario",$("#session_usuario_id").val()),o.append("usuario_rol",$("#session_rol_id").val()),o.append("id",e),Swal.fire({title:"¿Está seguro que desea eliminar el periodo?",text:"Este proceso no podrá ser revertido",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",confirmButtonColor:"#f06445",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&fetch(`${environment.apiSRD}/API/jci/periodos/eliminar-periodo`,{method:"POST",body:o}).then((e=>e.json())).then((e=>{1==e.estado?(Swal.fire({toast:!0,position:"top-end",icon:"success",title:"El periodo ha sido eliminado exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),$("#tb_periodos").DataTable().ajax.reload()):Swal.fire({html:ErrorMensaje(e),icon:"error",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn btn-primary"}})}))}))}function ObtenerDatos(){var e,o=Boolean(document.querySelector('input[name="filtro-estado"][value="1"]').checked),t=Boolean(document.querySelector('input[name="filtro-estado"][value="0"]').checked);0==o&&0==t?e="":1==o&&0==t?e="1":0==o&&1==t&&(e="0");var a=new Array;return a.periodo=$("[name='filtro-periodo']").val(),a.fecha=$("[name='filtro-fecha']").val(),a.estado=e,a.usuario=$("#session_usuario_id").val(),a.usuario_rol=$("#session_rol_id").val(),a}KTUtil.onDOMContentLoaded((function(){KTEvaluaciones.init()})),window.AbrirModalPeriodo=AbrirModalPeriodo,window.EliminarPeriodo=EliminarPeriodo;