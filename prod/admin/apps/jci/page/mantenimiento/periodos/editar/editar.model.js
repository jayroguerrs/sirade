"use strict";import{environment}from"../../../../../../../environment.js";var KTPeriodo=function(){var e,t,o,a;return $("#custom-pdf").on("click",(function(e){e.preventDefault(),a.button(".buttons-pdf").trigger()})),$("#custom-excel").on("click",(function(e){e.preventDefault(),a.button(".buttons-excel").trigger()})),$("#custom-csv").on("click",(function(e){e.preventDefault(),a.button(".buttons-csv").trigger()})),$("#custom-copy").on("click",(function(e){e.preventDefault(),a.button(".buttons-copy").trigger()})),{init:function(){o=document.getElementById("form_modal_agregar_periodos"),t=document.getElementById("kt_modal_agregar_periodos_submit"),document.getElementById("kt_modal_agregar_periodos_cancel"),(a=$("#tb_periodos").DataTable({searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,order:[[3,"desc"]],select:{style:"single",toggleable:!1},stateSave:!1,ajax:{type:"POST",url:`${environment.apiSRD}/API/periodos/lista-paginado`,data:function(e){var t=ObtenerDatos();e.idapp=t.idapp,e.periodo=t.periodo,e.fecha=t.fecha,e.estado=t.estado,e.usuario=$("#session_usuario_id").val(),e.usuario_rol=$("#session_rol_id").val()}},columns:[{data:null,name:"acciones"},{data:0,name:"NPERI_ID"},{data:1,name:"CPERI_DESCRIPCION"},{data:2,name:"DPERI_INICIO"},{data:3,name:"DPERI_FIN"},{data:4,name:"ESTADO"},{data:5,name:"FEC_MODIFICACION"},{data:6,name:"USR_MODIFICACION"}],columnDefs:[{targets:0,visible:!0,orderable:!1,className:"text-start",render:function(e,t,o){return`\n                            <a href="javascript:AbrirModalPeriodo('${o[0]}', 'editar');" class="btn btn-sm btn-icon btn bg-light-info btn-active-color-primary w-30px h-30px">\n                                <i class="ki-duotone ki-notepad-edit text-info fs-2">\n                                    <span class="path1"></span>\n                                    <span class="path2"></span>\n                                    <span class="path3"></span>\n                                    <span class="path4"></span>\n                                    <span class="path5"></span>\n                                </i>\n                            </a>\n                            <a href="javascript:EliminarPeriodo('${o[0]}');" class="btn btn-sm btn-icon btn bg-light-warning btn-active-color-primary w-30px h-30px">\n                                <i class="ki-duotone ki-trash text-warning fs-2">\n                                    <span class="path1"></span>\n                                    <span class="path2"></span>\n                                    <span class="path3"></span>\n                                    <span class="path4"></span>\n                                    <span class="path5"></span>\n                                </i>\n                            </a>\n                        `}},{targets:1,visible:!1},{targets:5,visible:!0,render:function(e,t,o){return`\n                            <div class="badge badge-light-${"ACTIVO"==e?"success":"danger"} fw-bold">${e}</div>\n                        `}}],buttons:[{extend:"collection",className:"btn btn-label-secondary dropdown-toggle mx-3",text:'<i class="bx bx-upload me-2"></i>Exportar',buttons:[{extend:"print",text:'<i class="bx bx-printer me-2" ></i>Imprimir',className:"dropdown-item",action:newexportaction,exportOptions:{columns:[1,2,3,4,5,6,7]}},{extend:"csv",bom:"true",text:'<i class="bx bx-file me-2" ></i>Csv',className:"dropdown-item",action:newexportaction,exportOptions:{columns:[1,2,3,4,5,6,7]},filename:"Reporte de Periodo"},{extend:"excel",text:'<i class="bx bx-file me-2" ></i>Excel',className:"dropdown-item",action:newexportaction,exportOptions:{columns:[1,2,3,4,5,6,7]},filename:"Reporte de Periodo"},{extend:"pdf",text:'<i class="bx bxs-file-pdf me-2"></i>Pdf',className:"dropdown-item",action:newexportaction,exportOptions:{columns:[1,2,3,4,5,6,7]},filename:"Reporte de Periodo",customize:function(e){e.content.unshift({text:"Reporte de Periodo",fontSize:14,alignment:"center",margin:[0,10]}),e.defaultStyle.fontSize=9,e.styles.tableHeader.fontSize=11,e.pageOrientation="landscape",e.pageSize="A4"}},{extend:"copy",text:'<i class="bx bx-copy me-2" ></i>Copiar',className:"dropdown-item",action:newexportaction,exportOptions:{columns:[1,2,3,4,5,6,7]}}]}]})).on("draw.dt",(function(){a.row(":eq(0)").select()})),a.$,a.on("draw",(function(){KTMenu.createInstances()})),$("form#form_modal_agregar_periodos [name=fecha]").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",locale:"es"}),$("form#form_modal_filtro_periodos [name=filtro-fecha]").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",locale:"es"}),document.querySelector('[data-kt-periodos-table-filter="search"]').addEventListener("keyup",(function(e){a.search(e.target.value).draw()})),e=FormValidation.formValidation(o,{fields:{periodo:{validators:{notEmpty:{message:"El periodo es requerido"}}},fecha:{validators:{notEmpty:{message:"La fecha es requerida"}}},estado:{validators:{integer:{message:"El estado debe ser un valor válido"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),t.addEventListener("click",(n=>{n.preventDefault(),e&&e.validate().then((function(n){if("Valid"==n){t.setAttribute("data-kt-indicator","on"),t.disabled=!0;var r=new FormData(o);r.append("idapp","ENF_003"),r.append("usuario",$("#session_usuario_id").val()),r.append("usuario_rol",$("#session_rol_id").val()),r.append("periodo",$('[name="periodo"]').val());var i="Agregar Periodo"==document.getElementById("titulo_modal").innerText?"agregar":"editar";Swal.fire({text:"¿Está seguro que desea guardar los cambios registrados?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Si, guardar",cancelButtonText:"No, cancelar",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then((function(t){t.value&&fetch(`${environment.apiSRD}/API/periodos/${i}-periodo`,{method:"POST",body:r}).then((e=>e.json())).then((t=>{1==t.estado?("agregar"==i?swal.fire({text:"Se ha agregado el periodo correctamente",icon:"success",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn font-weight-bold btn-light-primary"}}):Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los cambios han sido guardados exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),$('[name="id"]').val(null).trigger("change"),$('[name="periodo"]').val(null).trigger("change"),$('[name="fecha"]').val(null).trigger("change"),document.querySelector('input[name="estado"][value="1"]').checked=!1,document.querySelector('input[name="estado"][value="0"]').checked=!1,e.resetForm(),a.ajax.reload(),$("#kt_modal_agregar_periodos").modal("hide")):Swal.fire({html:ErrorMensaje(t),icon:"error",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn btn-primary"}})}))})),t.setAttribute("data-kt-indicator","off"),t.disabled=!1}}))})),document.querySelector("#kt_modal_filtro_periodos_submit").addEventListener("click",(function(e){e.preventDefault(),$("#kt_modal_filtro_periodos").modal("hide"),a.ajax.reload(),Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los filtros se han aplicado exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})})),document.querySelector("#kt_modal_filtro_periodos_limpiar").addEventListener("click",(function(e){e.preventDefault(),document.getElementById("form_modal_filtro_periodos").reset(),$('[name="filtro-periodos"]').val(null).trigger("change"),$('[name="filtro-fecha"]').val(null).trigger("change"),$("form#form_modal_filtro_periodos [name=filtro-fecha]").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",locale:"es"}).setDate([null,null]),document.querySelector('input[name="filtro-estado"][value="1"]').checked=!1,document.querySelector('input[name="filtro-estado"][value="0"]').checked=!1,a.ajax.reload(),Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los filtros se han limpiado exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})})),$("#kt_modal_agregar_periodos").on("hidden.bs.modal",(function(){$('[name="id"]').val(null).trigger("change"),$('[name="periodo"]').val(null).trigger("change"),$("form#form_modal_agregar_periodos [name=fecha]").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",locale:"es"}).setDate([null,null]),document.querySelector('input[name="estado"][value="1"]').checked=!1,document.querySelector('input[name="estado"][value="0"]').checked=!1,e.resetForm()}))}}}();function AbrirModalPeriodo(e,t){if("editar"==t){document.getElementById("div-estado").style.display="block";var o=new FormData;o.append("idapp","ENF_003"),o.append("usuario",$("#session_usuario_id").val()),o.append("usuario_rol",$("#session_rol_id").val()),o.append("id",e),fetch(`${environment.apiSRD}/API/periodos/obtener-por-id`,{method:"POST",body:o}).then((e=>e.json())).then((e=>{if(1==e.estado){var t=e.data,o=$("form#form_modal_agregar_periodos [name=fecha]").flatpickr({altInput:!0,altFormat:"d/m/Y",dateFormat:"Y-m-d",mode:"range",locale:"es"});$('[name="id"]').val(t.id).trigger("change"),$('[name="periodo"]').val(t.periodo).trigger("change"),o.setDate([t.fecha_inicio,t.fecha_fin]),document.querySelector(`input[name="estado"][value="${t.estado}"]`).checked=!0}else Swal.fire({html:ErrorMensaje(e),icon:"error",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn btn-primary"}})})),document.getElementById("titulo_modal").innerText="Editar Periodo"}else document.getElementById("div-estado").style.display="none",document.getElementById("titulo_modal").innerText="Agregar Periodo";$("#kt_modal_agregar_periodos").modal("show")}function EliminarPeriodo(e){var t=new FormData;t.append("idapp","ENF_003"),t.append("usuario",$("#session_usuario_id").val()),t.append("usuario_rol",$("#session_rol_id").val()),t.append("id",e),Swal.fire({title:"¿Está seguro que desea eliminar el periodo?",text:"Este proceso no podrá ser revertido",icon:"warning",showCancelButton:!0,confirmButtonText:"Si, eliminar",confirmButtonColor:"#f06445",cancelButtonText:"Cancelar"}).then((e=>{e.isConfirmed&&fetch(`${environment.apiSRD}/API/periodos/eliminar-periodo`,{method:"POST",body:t}).then((e=>e.json())).then((e=>{1==e.estado?(Swal.fire({toast:!0,position:"top-end",icon:"success",title:"El periodo ha sido eliminado exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),$("#tb_periodos").DataTable().ajax.reload()):Swal.fire({html:ErrorMensaje(e),icon:"error",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn btn-primary"}})}))}))}function ObtenerDatos(){var e,t=Boolean(document.querySelector('input[name="filtro-estado"][value="1"]').checked),o=Boolean(document.querySelector('input[name="filtro-estado"][value="0"]').checked);0==t&&0==o?e="":1==t&&0==o?e="1":0==t&&1==o&&(e="0");var a=new Array;return a.idapp="ENF_003",a.periodo=$("[name='filtro-periodo']").val(),a.fecha=$("[name='filtro-fecha']").val(),a.estado=e,a.usuario=$("#session_usuario_id").val(),a.usuario_rol=$("#session_rol_id").val(),a}KTUtil.onDOMContentLoaded((function(){KTPeriodo.init()})),window.AbrirModalPeriodo=AbrirModalPeriodo,window.EliminarPeriodo=EliminarPeriodo;