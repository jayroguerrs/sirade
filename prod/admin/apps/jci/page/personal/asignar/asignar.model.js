"use strict";import{environment}from"../../../../../../environment.js";var KTPersonalList=function(){var e,n,a,t,s,i;$("[name='desempenio']").on("change.select2",(function(){s.ajax.reload()})),$("[name='act_disponibles']").on("click",(function(){s.ajax.reload()})),$("[name='act_asignados']").on("click",(function(){i.ajax.reload()})),$("[name='servicio']").on("change.select2",(function(){i.ajax.reload()})),$("[name='periodo']").on("change.select2",(function(){var n=null!=$("[name='periodo']").val();e.disabled=!n}));var o=function(){(s=$("#colab_disponibles").DataTable({searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,select:{style:"single",toggleable:!1},order:[[2,"asc"]],stateSave:!1,lengthMenu:[10],dom:'rt<"bottom"ip><"clear">',ajax:{type:"POST",url:`${environment.apiSRD}/API/jci/personal/lista-disponible`,data:function(e){$.extend(e,{periodo:$("[name='periodo']").val(),estado:1,desempenio:$("[name='desempenio']").val(),usuario:$("#session_usuario_id").val(),usuario_rol:$("#session_rol_id").val()})}},columnDefs:[{targets:0,visible:!1,render:function(e,n,a){return`                        \n                      <span class="fw-bold fs-6">${e}</span>                      \n                    `}},{targets:1,visible:!1},{targets:2,visible:!0,className:"d-flex align-items-center",render:function(e,n,a){var t=a[3];if("blank.png"!=t)var s='<div class=symbol-label><img src="assets/media/avatars/'+t+'" alt="Avatar" class="w-100"></div>';else{var i=["success","danger","warning","info","dark","primary","secondary"][Math.floor(6*Math.random())],o=e.match(/\b\w/g)||[];s='<div class="symbol-label fs-3 bg-light-'+i+" text-"+i+'">'+(o=((o.shift()||"")+(o.pop()||"")).toUpperCase())+"</div>"}return`                        \n                      \x3c!--begin:: Avatar --\x3e\n                      <div class="symbol symbol-circle symbol-50px overflow-hidden me-3">\n                        <span">${s}</span>\n                      </div>\n                      \x3c!--end::Avatar--\x3e\n\n                      \x3c!--begin::User details--\x3e\n                      <div class="d-flex flex-column" data-kt-menu-trigger="{default: 'click', lg: 'hover'}" data-kt-menu-placement="bottom-start" data-kt-menu-overflow="true">\n                        <span class="fw-bold fs-7">${e}</span>\n                      </div>\n                      \x3c!--end::User details--\x3e\n                      \x3c!--begin::Menu 3--\x3e\n                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-auto py-3" data-kt-menu="true">\n                            \x3c!--begin::Title--\x3e\n                            <div class="menu-item px-3">\n                                <div class="menu-content d-flex align-items-center px-3">\n                                    \x3c!--begin::Username--\x3e\n                                    <div class="d-flex flex-column">\n                                        <div class="fw-bold d-flex align-items-center fs-5">\n                                            Detalles Adicionales\n                                        </div>\n                                    </div>\n                                    \x3c!--end::Username--\x3e\n                                </div>\n                            </div>\n                            \x3c!--end::Title--\x3e\n\n                            \x3c!--begin::Menu separator--\x3e\n                            <div class="separator my-2"></div>\n                            \x3c!--end::Menu separator--\x3e\n\n                            <div class="d-flex flex-wrap p-5">    \n                                \x3c!--begin::Row--\x3e\n                                <div class="flex-equal me-5">\n                                    \x3c!--begin::Details--\x3e\n                                    <table class="table fs-6 fw-semibold gs-0 gy-2 gx-2 m-0">\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500 min-w-175px w-175px">Código:</td>\n                                            <td class="text-gray-800 min-w-175px">\n                                                <span>${a[1]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500">Nacionalidad:</td>\n                                            <td class="text-gray-800">\n                                                <img src="assets/media/flags/${a[5]}" class="me-3" style="width: 20px;border-radius: 4px" alt=""/>\n                                                <span>${a[4]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500">Desempeño:</td>\n                                            <td class="text-gray-800">\n                                                <span>${a[7]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                    </table>\n                                    \x3c!--end::Details--\x3e\n                                </div>\n                                \x3c!--end::Row--\x3e\n                            </div>\n                        </div>\n                        \x3c!--end::Menu 3--\x3e\n                    `}},{targets:3,visible:!1,render:function(e,n,a){return`\n                      <div class="badge badge-light-${"ACTIVO"==e?"success":"danger"} fw-bold">${e}</div>\n                    `}},{targets:4,visible:!1},{targets:5,visible:!1},{targets:6,visible:!1},{targets:7,visible:!1},{targets:-1,visible:!0,data:null,orderable:!1,className:"text-end",render:function(e,n,a){return`\n                        <a onclick="asignar('${a[0]}', '${$("[name='periodo']").val()}');" class="btn btn-light btn-active-light-primary btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end">                                \n                            <i class="ki-duotone ki-double-right">\n                                <span class="path1"></span>\n                                <span class="path2"></span>\n                            </i>\n                        </a>\n                    `}}]})).on("draw.dt",(function(){s.row(":eq(0)").select()})),s.$,s.on("draw",(function(){$('[data-bs-toggle="tooltip"]').tooltip(),KTMenu.createInstances()}))},r=function(){(i=$("#colab_asignados").DataTable({searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,select:{style:"single",toggleable:!1},order:[[2,"asc"]],stateSave:!1,lengthMenu:[10],dom:'rt<"bottom"ip><"clear">',ajax:{type:"POST",url:`${environment.apiSRD}/API/jci/personal/lista-asignado`,data:function(e){$.extend(e,{periodo:$("[name='periodo']").val(),estado:1,servicio:$("[name='servicio']").val(),usuario:$("#session_usuario_id").val(),usuario_rol:$("#session_rol_id").val()})}},columnDefs:[{targets:0,visible:!0,data:null,orderable:!1,className:"text-start",render:function(e,n,a){return`\n                      <a href="javascript:quitar('${a[1]}');" class="btn btn-light btn-active-light-primary btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end">                                \n                        <i class="ki-duotone ki-double-left">\n                            <span class="path1"></span>\n                            <span class="path2"></span>\n                        </i>\n                      </a>\n                    `}},{targets:1,visible:!1},{targets:2,visible:!1},{targets:3,visible:!0,className:"d-flex align-items-center",render:function(e,n,a){var t=a[4];if("blank.png"!=t)var s='<div class=symbol-label><img src="assets/media/avatars/'+t+'" alt="Avatar" class="w-100"></div>';else{var i=["success","danger","warning","info","dark","primary","secondary"][Math.floor(6*Math.random())],o=e.match(/\b\w/g)||[];s='<div class="symbol-label fs-3 bg-light-'+i+" text-"+i+'">'+(o=((o.shift()||"")+(o.pop()||"")).toUpperCase())+"</div>"}return`                        \n                      \x3c!--begin:: Avatar --\x3e\n                      <div class="symbol symbol-circle symbol-50px overflow-hidden me-3">\n                        <span">${s}</span>\n                      </div>\n                      \x3c!--end::Avatar--\x3e\n\n                      \x3c!--begin::User details--\x3e\n                      <div class="d-flex flex-column" data-kt-menu-trigger="{default: 'click', lg: 'hover'}" data-kt-menu-placement="bottom-start" data-kt-menu-overflow="true">\n                        <span class="fw-bold fs-7">${e}</span>\n                      </div>\n                      \x3c!--end::User details--\x3e\n                      \x3c!--begin::Menu 3--\x3e\n                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-auto py-3" data-kt-menu="true">\n                            \x3c!--begin::Title--\x3e\n                            <div class="menu-item px-3">\n                                <div class="menu-content d-flex align-items-center px-3">\n                                    \x3c!--begin::Username--\x3e\n                                    <div class="d-flex flex-column">\n                                        <div class="fw-bold d-flex align-items-center fs-5">\n                                            Detalles Adicionales\n                                        </div>\n                                    </div>\n                                    \x3c!--end::Username--\x3e\n                                </div>\n                            </div>\n                            \x3c!--end::Title--\x3e\n\n                            \x3c!--begin::Menu separator--\x3e\n                            <div class="separator my-2"></div>\n                            \x3c!--end::Menu separator--\x3e\n\n                            <div class="d-flex flex-wrap p-5">    \n                                \x3c!--begin::Row--\x3e\n                                <div class="flex-equal me-5">\n                                    \x3c!--begin::Details--\x3e\n                                    <table class="table fs-6 fw-semibold gs-0 gy-2 gx-2 m-0">\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500 min-w-175px w-175px">Código:</td>\n                                            <td class="text-gray-800 min-w-175px">\n                                                <span>${a[2]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500">Nacionalidad:</td>\n                                            <td class="text-gray-800">\n                                                <img src="assets/media/flags/${a[6]}" class="me-3" style="width: 20px;border-radius: 4px" alt=""/>\n                                                <span>${a[5]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500">Desempeño:</td>\n                                            <td class="text-gray-800">\n                                                <span>${a[9]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500">Servicio:</td>\n                                            <td class="text-gray-800">\n                                                <span>${a[7]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                    </table>\n                                    \x3c!--end::Details--\x3e\n                                </div>\n                                \x3c!--end::Row--\x3e\n                            </div>\n                        </div>\n                        \x3c!--end::Menu 3--\x3e\n                    `}},{targets:4,visible:!1,render:function(e,n,a){return`\n                      <div class="badge badge-light-${"ACTIVO"==e?"success":"danger"} fw-bold">${e}</div>\n                    `}},{targets:5,visible:!1},{targets:6,visible:!1},{targets:7,visible:!1},{targets:8,visible:!1},{targets:9,visible:!1},{targets:-1,visible:!0,data:null,orderable:!1,className:"text-end",render:function(e,n,a){return'\n                      <a href="#" class="btn btn-light btn-active-light-primary btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end">                                \n                        <i class="ki-duotone ki-double-left">\n                            <span class="path1"></span>\n                            <span class="path2"></span>\n                        </i>\n                      </a>\n                    '}}]})).on("draw.dt",(function(){i.row(":eq(0)").select()})),s.$,i.on("draw",(function(){$('[data-bs-toggle="tooltip"]').tooltip(),KTMenu.createInstances()}))};return{init:function(){a=document.getElementById("formAsignar"),e=document.getElementById("btn_continuar"),n=document.getElementById("btn_limpiar"),e.disabled=!0,t=FormValidation.formValidation(a,{fields:{periodo:{validators:{notEmpty:{message:"Seleccione un periodo"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),e.addEventListener("click",(a=>{a.preventDefault(),t?(e.setAttribute("data-kt-indicator","on"),e.disabled=!0,n.disabled=!0,setTimeout((function(){o(),r(),e.setAttribute("data-kt-indicator","off"),Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Verificación exitosa, puede continuar",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),document.getElementById("div-asignar").classList.remove("d-none"),$("[name='periodo']").prop("disabled",!0)}),500)):Swal.fire({toast:!0,position:"top-end",icon:"warning",title:"Hay campos obligatorios pendientes de completar",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})})),function(){const e=document.querySelector('[data-kt-colaborador-table-filter="search"]'),n=document.querySelector('[data-kt-asignado-table-filter="search"]');e.addEventListener("keyup",(function(e){s.search(e.target.value).draw()})),n.addEventListener("keyup",(function(e){i.search(e.target.value).draw()}))}()}}}();function asignar(e,n){const a=new FormData;a.append("usuario",$("#session_usuario_id").val()),a.append("usuario_rol",$("#session_rol_id").val()),a.append("colaborador",e),a.append("periodo",n),a.append("servicio",$("[name='servicio']").val()),fetch(`${environment.apiSRD}/API/jci/personal/agregar-asignacion`,{method:"POST",body:a}).then((e=>e.json())).then((e=>{1==e.estado?Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los cambios han sido guardados exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}):Swal.fire({toast:!0,position:"top-end",icon:"warning",title:e.data[1],showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),$("#colab_disponibles").DataTable().ajax.reload(),$("#colab_asignados").DataTable().ajax.reload()}))}function quitar(e){const n=new FormData;n.append("usuario",$("#session_usuario_id").val()),n.append("usuario_rol",$("#session_rol_id").val()),n.append("encuesta",e),fetch(`${environment.apiSRD}/API/jci/personal/quitar-asignacion`,{method:"POST",body:n}).then((e=>e.json())).then((e=>{1==e.estado?Swal.fire({toast:!0,position:"top-end",icon:"success",title:"Los cambios han sido guardados exitosamente",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}):Swal.fire({toast:!0,position:"top-end",icon:"warning",title:e.data[1],showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),$("#colab_disponibles").DataTable().ajax.reload(),$("#colab_asignados").DataTable().ajax.reload()}))}KTUtil.onDOMContentLoaded((function(){KTPersonalList.init()})),window.asignar=asignar,window.quitar=quitar;