"use strict";import{environment}from"../../../../../../environment.js";var KTPersonalList=function(){var e,a,n,t,s,i;$("[name='desempenio']").on("change.select2",(function(){s.ajax.reload()})),$("[name='act_disponibles']").on("click",(function(){s.ajax.reload()})),$("[name='act_asignados']").on("click",(function(){i.ajax.reload()})),$("[name='servicio']").on("change.select2",(function(){i.ajax.reload()})),$("[name='periodo']").on("change.select2",(function(){var a=null!=$("[name='periodo']").val();e.disabled=!a}));const o=()=>{t=FormValidation.formValidation(n,{fields:{periodo:{validators:{notEmpty:{message:"Seleccione un periodo"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),e.addEventListener("click",(n=>{n.preventDefault(),t?(e.setAttribute("data-kt-indicator","on"),e.disabled=!0,a.disabled=!0,setTimeout((function(){(s=$("#colab_disponibles").DataTable({searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,select:{style:"single",toggleable:!1},order:[[2,"asc"]],stateSave:!1,lengthMenu:[10],dom:'rt<"bottom"ip><"clear">',ajax:{type:"POST",url:`${environment.apiSRD}/API/jci/personal/lista-disponible`,data:function(e){var a=ObtenerDatosDisponibles();e.periodo=a.periodo,e.desempenio=a.desempenio,e.estado=a.estado,e.usuario=$("#session_usuario_id").val(),e.usuario_rol=$("#session_rol_id").val()}},columns:[{data:0,name:"NUSUA_ID"},{data:1,name:"CUSUA_CODIGO"},{data:2,name:"CUSUA_NOMBRES"},{data:3,name:"CUSUA_IMG"},{data:4,name:"CNACI_DESCRIPCION"},{data:5,name:"CNACI_IMAGEN"},{data:6,name:"CAREA_ID"},{data:7,name:"CDESE_DESCRIPCION"},{data:null,name:"acciones"}],columnDefs:[{targets:0,visible:!1,render:function(e,a,n){return`                        \n                            <span class="fw-bold fs-6">${e}</span>                      \n                        `}},{targets:1,visible:!1},{targets:2,visible:!0,className:"d-flex align-items-center",render:function(e,a,n){var t=n[3];if("blank.png"!=t)var s='<div class=symbol-label><img src="assets/media/avatars/'+t+'" alt="Avatar" class="w-100"></div>';else{var i=["success","danger","warning","info","dark","primary","secondary"][Math.floor(6*Math.random())],o=e.match(/\b\w/g)||[];s='<div class="symbol-label fs-3 bg-light-'+i+" text-"+i+'">'+(o=((o.shift()||"")+(o.pop()||"")).toUpperCase())+"</div>"}return`                        \n                        \x3c!--begin:: Avatar --\x3e\n                        <div class="symbol symbol-circle symbol-50px overflow-hidden me-3">\n                            <span">${s}</span>\n                        </div>\n                        \x3c!--end::Avatar--\x3e\n\n                        \x3c!--begin::User details--\x3e\n                        <div class="d-flex flex-column" data-kt-menu-trigger="{default: 'click', lg: 'hover'}" data-kt-menu-placement="bottom-start" data-kt-menu-overflow="true">\n                            <span class="fw-bold fs-7">${e}</span>\n                        </div>\n                        \x3c!--end::User details--\x3e\n                        \x3c!--begin::Menu 3--\x3e\n                            <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-auto py-3" data-kt-menu="true">\n                                \x3c!--begin::Title--\x3e\n                                <div class="menu-item px-3">\n                                    <div class="menu-content d-flex align-items-center px-3">\n                                        \x3c!--begin::Username--\x3e\n                                        <div class="d-flex flex-column">\n                                            <div class="fw-bold d-flex align-items-center fs-5">\n                                                Detalles Adicionales\n                                            </div>\n                                        </div>\n                                        \x3c!--end::Username--\x3e\n                                    </div>\n                                </div>\n                                \x3c!--end::Title--\x3e\n\n                                \x3c!--begin::Menu separator--\x3e\n                                <div class="separator my-2"></div>\n                                \x3c!--end::Menu separator--\x3e\n\n                                <div class="d-flex flex-wrap p-5">    \n                                    \x3c!--begin::Row--\x3e\n                                    <div class="flex-equal me-5">\n                                        \x3c!--begin::Details--\x3e\n                                        <table class="table fs-6 fw-semibold gs-0 gy-2 gx-2 m-0">\n                                            \x3c!--begin::Row--\x3e\n                                            <tr>\n                                                <td class="text-gray-500 min-w-175px w-175px">Código:</td>\n                                                <td class="text-gray-800 min-w-175px">\n                                                    <span>${n[1]}</span>\n                                                </td>\n                                            </tr>\n                                            \x3c!--end::Row--\x3e\n                                            \x3c!--begin::Row--\x3e\n                                            <tr>\n                                                <td class="text-gray-500">Nacionalidad:</td>\n                                                <td class="text-gray-800">\n                                                    <img src="assets/media/flags/${n[5]}" class="me-3" style="width: 20px;border-radius: 4px" alt=""/>\n                                                    <span>${n[4]}</span>\n                                                </td>\n                                            </tr>\n                                            \x3c!--end::Row--\x3e\n                                            \x3c!--begin::Row--\x3e\n                                            <tr>\n                                                <td class="text-gray-500">Desempeño:</td>\n                                                <td class="text-gray-800">\n                                                    <span>${n[7]}</span>\n                                                </td>\n                                            </tr>\n                                            \x3c!--end::Row--\x3e\n                                        </table>\n                                        \x3c!--end::Details--\x3e\n                                    </div>\n                                    \x3c!--end::Row--\x3e\n                                </div>\n                            </div>\n                            \x3c!--end::Menu 3--\x3e\n                        `}},{targets:3,visible:!1,render:function(e,a,n){return`\n                      <div class="badge badge-light-${"ACTIVO"==e?"success":"danger"} fw-bold">${e}</div>\n                    `}},{targets:4,visible:!1},{targets:5,visible:!1},{targets:6,visible:!1},{targets:7,visible:!1},{targets:8,visible:!0,data:null,orderable:!1,className:"text-end",render:function(e,a,n){return`\n                        <a onclick="asignar('${n[0]}', '${$("[name='periodo']").val()}');" class="btn btn-light btn-active-light-primary btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end">                                \n                            <i class="ki-duotone ki-double-right">\n                                <span class="path1"></span>\n                                <span class="path2"></span>\n                            </i>\n                        </a>\n                    `}}]})).on("draw.dt",(function(){s.row(":eq(0)").select()})),s.$,s.on("draw",(function(){$('[data-bs-toggle="tooltip"]').tooltip(),KTMenu.createInstances()})),(i=$("#colab_asignados").DataTable({searchDelay:500,processing:!0,serverSide:!0,scrollX:!0,select:{style:"single",toggleable:!1},order:[[2,"asc"]],stateSave:!1,lengthMenu:[10],dom:'rt<"bottom"ip><"clear">',ajax:{type:"POST",url:`${environment.apiSRD}/API/jci/personal/lista-asignado`,data:function(e){var a=ObtenerDatosAsignados();e.periodo=a.periodo,e.servicio=a.servicio,e.estado=a.estado,e.usuario=$("#session_usuario_id").val(),e.usuario_rol=$("#session_rol_id").val()}},columns:[{data:null,name:"acciones"},{data:0,name:"NUSUA_ID"},{data:1,name:"NJENC_ID"},{data:2,name:"CUSUA_CODIGO"},{data:3,name:"CUSUA_NOMBRES"},{data:4,name:"CUSUA_IMG"},{data:5,name:"CNACI_DESCRIPCION"},{data:6,name:"CNACI_IMAGEN"},{data:7,name:"CAREA_ID"},{data:8,name:"SUPERVISOR"},{data:9,name:"CDESE_DESCRIPCION"}],columnDefs:[{targets:0,visible:!1},{targets:1,visible:!0,data:null,orderable:!1,className:"text-start",render:function(e,a,n){return`\n                      <a href="javascript:quitar('${n[1]}');" class="btn btn-light btn-active-light-primary btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end">                                \n                        <i class="ki-duotone ki-double-left">\n                            <span class="path1"></span>\n                            <span class="path2"></span>\n                        </i>\n                      </a>\n                    `}},{targets:2,visible:!1},{targets:3,visible:!1},{targets:4,visible:!0,className:"d-flex align-items-center",render:function(e,a,n){var t=n[4];if("blank.png"!=t)var s='<div class=symbol-label><img src="assets/media/avatars/'+t+'" alt="Avatar" class="w-100"></div>';else{var i=["success","danger","warning","info","dark","primary","secondary"][Math.floor(6*Math.random())],o=e.match(/\b\w/g)||[];s='<div class="symbol-label fs-3 bg-light-'+i+" text-"+i+'">'+(o=((o.shift()||"")+(o.pop()||"")).toUpperCase())+"</div>"}return`                        \n                      \x3c!--begin:: Avatar --\x3e\n                      <div class="symbol symbol-circle symbol-50px overflow-hidden me-3">\n                        <span">${s}</span>\n                      </div>\n                      \x3c!--end::Avatar--\x3e\n\n                      \x3c!--begin::User details--\x3e\n                      <div class="d-flex flex-column" data-kt-menu-trigger="{default: 'click', lg: 'hover'}" data-kt-menu-placement="bottom-start" data-kt-menu-overflow="true">\n                        <span class="fw-bold fs-7">${e}</span>\n                      </div>\n                      \x3c!--end::User details--\x3e\n                      \x3c!--begin::Menu 3--\x3e\n                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-semibold w-auto py-3" data-kt-menu="true">\n                            \x3c!--begin::Title--\x3e\n                            <div class="menu-item px-3">\n                                <div class="menu-content d-flex align-items-center px-3">\n                                    \x3c!--begin::Username--\x3e\n                                    <div class="d-flex flex-column">\n                                        <div class="fw-bold d-flex align-items-center fs-5">\n                                            Detalles Adicionales\n                                        </div>\n                                    </div>\n                                    \x3c!--end::Username--\x3e\n                                </div>\n                            </div>\n                            \x3c!--end::Title--\x3e\n\n                            \x3c!--begin::Menu separator--\x3e\n                            <div class="separator my-2"></div>\n                            \x3c!--end::Menu separator--\x3e\n\n                            <div class="d-flex flex-wrap p-5">    \n                                \x3c!--begin::Row--\x3e\n                                <div class="flex-equal me-5">\n                                    \x3c!--begin::Details--\x3e\n                                    <table class="table fs-6 fw-semibold gs-0 gy-2 gx-2 m-0">\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500 min-w-175px w-175px">Código:</td>\n                                            <td class="text-gray-800 min-w-175px">\n                                                <span>${n[2]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500">Nacionalidad:</td>\n                                            <td class="text-gray-800">\n                                                <img src="assets/media/flags/${n[6]}" class="me-3" style="width: 20px;border-radius: 4px" alt=""/>\n                                                <span>${n[5]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500">Desempeño:</td>\n                                            <td class="text-gray-800">\n                                                <span>${n[9]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                        \x3c!--begin::Row--\x3e\n                                        <tr>\n                                            <td class="text-gray-500">Servicio:</td>\n                                            <td class="text-gray-800">\n                                                <span>${n[7]}</span>\n                                            </td>\n                                        </tr>\n                                        \x3c!--end::Row--\x3e\n                                    </table>\n                                    \x3c!--end::Details--\x3e\n                                </div>\n                                \x3c!--end::Row--\x3e\n                            </div>\n                        </div>\n                        \x3c!--end::Menu 3--\x3e\n                    `}},{targets:5,visible:!1,render:function(e,a,n){return`\n                      <div class="badge badge-light-${"ACTIVO"==e?"success":"danger"} fw-bold">${e}</div>\n                    `}},{targets:6,visible:!1},{targets:7,visible:!1},{targets:8,visible:!1},{targets:9,visible:!1},{targets:10,visible:!1},{targets:-1,visible:!0,data:null,orderable:!1,className:"text-end",render:function(e,a,n){return'\n                      <a href="#" class="btn btn-light btn-active-light-primary btn-sm" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end">                                \n                        <i class="ki-duotone ki-double-left">\n                            <span class="path1"></span>\n                            <span class="path2"></span>\n                        </i>\n                      </a>\n                    '}}]})).on("draw.dt",(function(){i.row(":eq(0)").select()})),s.$,i.on("draw",(function(){$('[data-bs-toggle="tooltip"]').tooltip(),KTMenu.createInstances()})),e.setAttribute("data-kt-indicator","off"),msgSuccessMixin("Verificación exitosa, puede continuar",""),document.getElementById("div-asignar").classList.remove("d-none"),$("[name='periodo']").prop("disabled",!0)}),500)):msgWarningMixin("Hay campos obligatorios pendientes de completar","")}))};return{init:function(){n=document.getElementById("formAsignar"),e=document.getElementById("btn_continuar"),a=document.getElementById("btn_limpiar"),e.disabled=!0,o(),function(){const e=document.querySelector('[data-kt-colaborador-table-filter="search"]'),a=document.querySelector('[data-kt-asignado-table-filter="search"]');e.addEventListener("keyup",(function(e){s.search(e.target.value).draw()})),a.addEventListener("keyup",(function(e){i.search(e.target.value).draw()}))}()}}}();function asignar(e,a){const n=new FormData;n.append("usuario",$("#session_usuario_id").val()),n.append("usuario_rol",$("#session_rol_id").val()),n.append("colaborador",e),n.append("periodo",a),n.append("servicio",$("[name='filtro-servicio-asig']").val()),fetch(`${environment.apiSRD}/API/jci/personal/agregar-asignacion`,{method:"POST",body:n}).then((e=>e.json())).then((e=>{1==e.estado?msgSuccessMixin("Los cambios se han guardado exitosamente",""):msgWarningMixin(e.mensaje,""),$("#colab_disponibles").DataTable().ajax.reload(),$("#colab_asignados").DataTable().ajax.reload()}))}function quitar(e){const a=new FormData;a.append("usuario",$("#session_usuario_id").val()),a.append("usuario_rol",$("#session_rol_id").val()),a.append("encuesta",e),fetch(`${environment.apiSRD}/API/jci/personal/quitar-asignacion`,{method:"POST",body:a}).then((e=>e.json())).then((e=>{1==e.estado?msgSuccessMixin("Los cambios se han guardado exitosamente",""):msgWarningMixin(e.mensaje,""),$("#colab_disponibles").DataTable().ajax.reload(),$("#colab_asignados").DataTable().ajax.reload()}))}function ObtenerDatosDisponibles(){var e=new Array;return e.periodo=$("[name='filtro-periodo-disp']").val(),e.desempenio=$("[name='filtro-desempenio-disp']").val(),e.estado=1,e.usuario=$("#session_usuario_id").val(),e.usuario_rol=$("#session_rol_id").val(),e}function ObtenerDatosAsignados(){var e=new Array;return e.periodo=$("[name='periodo']").val(),e.servicio=$("[name='filtro-servicio-asig']").val(),e.estado=1,e.usuario=$("#session_usuario_id").val(),e.usuario_rol=$("#session_rol_id").val(),e}KTUtil.onDOMContentLoaded((function(){KTPersonalList.init()})),window.asignar=asignar,window.quitar=quitar;