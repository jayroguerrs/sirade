"use strict";import{environment}from"../../../../../../../environment.js";var KTPerfil=function(){var e,t,o,a,n,i,r,s,d,c,l,u,m,g,p=function(){i.classList.toggle("d-none"),c.classList.toggle("d-none"),r.classList.toggle("d-none")},v=function(){s.classList.toggle("d-none"),u.classList.toggle("d-none"),d.classList.toggle("d-none")},_=function(e){const t={id:document.querySelector("input[name='hd_id']").value,usuario:document.querySelector("#session_usuario_id").value,usuario_rol:document.querySelector("#session_rol_id").value},o=new URLSearchParams(t).toString();fetch(`${environment.apiSRD}/API/admin/obtener-por-id?${o}`,{method:"GET"}).then((e=>e.json())).then((e=>{1==e.estado?(e=e.data,document.querySelector("input[name='sh_cod']").value=e.codigo,document.querySelector("#lbl_usuario").textContent=e.usuario,document.querySelector("input[name='documento']").value=e.documento,document.querySelector("input[name='nombres']").value=e.nombres,document.querySelector("input[name='correo']").value=e.correo,0==e.estado?(document.getElementById("titulo").textContent="Activar cuenta",document.getElementById("kt_account_deactivate_account_submit").textContent="Activar cuenta",document.getElementById("titulo-aviso").textContent="Estas activando esta cuenta",document.getElementById("notice-div").classList.remove("bg-light-warning"),document.getElementById("notice-div").classList.remove("border-warning"),document.getElementById("notice-div").classList.add("bg-light-primary"),document.getElementById("notice-div").classList.add("border-primary"),document.getElementById("notice-icono").classList.remove("text-warning"),document.getElementById("notice-icono").classList.add("text-primary"),document.getElementById("kt_account_deactivate_account_submit").classList.remove("btn-danger"),document.getElementById("kt_account_deactivate_account_submit").classList.add("btn-primary")):(document.getElementById("titulo").textContent="Desactivar cuenta",document.getElementById("kt_account_deactivate_account_submit").textContent="Desactivar cuenta",document.getElementById("titulo-aviso").textContent="Estas desactivando esta cuenta",document.getElementById("notice-div").classList.remove("bg-light-primary"),document.getElementById("notice-div").classList.remove("border-primary"),document.getElementById("notice-div").classList.add("bg-light-warning"),document.getElementById("notice-div").classList.add("border-warning"),document.getElementById("notice-icono").classList.remove("text-primary"),document.getElementById("notice-icono").classList.add("text-warning"),document.getElementById("kt_account_deactivate_account_submit").classList.remove("btn-primary"),document.getElementById("kt_account_deactivate_account_submit").classList.add("btn-danger")),$("[name='desempenio']").val(e.desempenio).trigger("change"),$("[name='ocupacion']").val(e.ocupacion).trigger("change"),$("[name='nacionalidad']").val(e.nacionalidad).trigger("change"),document.querySelector("#sh_img").style.backgroundImage="url('assets/media/avatars/"+e.imagen+"')",$("[name='rol']").val(e.rol).trigger("change"),$("[name='estado']").val(e.estado).trigger("change")):msgError(ErrorMensaje(e),(()=>{2==e.estado&&location.reload()}),(()=>{2==e.estado&&location.reload()}))}))};return{init:function(){var y;(e=document.getElementById("image_form"),t=document.getElementById("kt_usuario_cambio"),o=document.getElementById("kt_signin_change_password"),a=document.getElementById("kt_account_profile_details_form"),n=document.querySelector("#kt_account_deactivate_form"),i=document.getElementById("kt_usuario"),r=document.getElementById("kt_usuario_edit"),s=document.getElementById("kt_signin_password"),d=document.getElementById("kt_signin_password_edit"),c=document.getElementById("kt_usuario_button"),l=document.getElementById("kt_signin_cancel"),u=document.getElementById("kt_signin_password_button"),m=document.getElementById("kt_password_cancel"),g=document.querySelector("#kt_account_deactivate_account_submit"),n)&&($(".select-iconos").select2({templateSelection:optionFormat,templateResult:optionFormat}),_(),i&&(c.querySelector("button").addEventListener("click",(function(){p()})),l.addEventListener("click",(function(){p()})),u.querySelector("button").addEventListener("click",(function(){v()})),m.addEventListener("click",(function(){v()}))),a&&(y=FormValidation.formValidation(a,{fields:{sh_cod:{validators:{notEmpty:{message:"Código es obligatorio"}},stringLength:{min:8,max:8,message:"El código debe tener 8 caracteres"}},documento:{validators:{notEmpty:{message:"Contraseña es obligatoria"},stringLength:{min:8,max:20,message:"La contraseña debe tener entre 8 y 20 caracteres"}}},nombres:{validators:{notEmpty:{message:"El nombre es obligatorio"},stringLength:{max:50,message:"El nombre debe tener máximo 300 caracteres"}}},ocupacion:{validators:{notEmpty:{message:"La ocupación es obligatoria"}}},correo:{validators:{notEmpty:{message:"El correo es obligatorio"},emailAddress:{message:"El correo no es válido"}}},nacionalidad:{validators:{notEmpty:{message:"La nacionalidad es obligatoria"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row"})}}),a.querySelector("#kt_account_profile_details_submit").addEventListener("click",(function(e){e.preventDefault(),msgLoad("Procesando...");let t=new FormData(a);t.append("usuario",document.querySelector("#session_usuario_id").value),t.append("usuario_rol",document.querySelector("#session_rol_id ").value),t.append("id",document.querySelector("input[name='hd_id']").value),y.validate().then((function(e){"Valid"==e?msgConfirm("¿Está seguro que desea guardar los datos?",(()=>{fetch(`${environment.apiSRD}/API/admin/actualizar-datos`,{method:"POST",body:t}).then((e=>e.json())).then((e=>{1==e.estado?(a.reset(),y.resetForm(),_(),msgSuccessMixin("Los cambios han sido guardados exitosamente","")):msgError(ErrorMensaje(e),(()=>{2==e.estado&&location.reload()}),(()=>{2==e.estado&&location.reload()}))}))})):msgError("Hay campos pendientes de validación, por favor revise el formulario.",(()=>{}),(()=>{}))}))}))),function(){var e;t&&(e=FormValidation.formValidation(t,{fields:{usuariocolab:{validators:{notEmpty:{message:"Usuario es obligatorio"},stringLength:{min:8,max:20,message:"El usuario debe tener entre 8 y 20 caracteres"}}},password1:{validators:{notEmpty:{message:"Contraseña es obligatoria"},stringLength:{min:8,max:20,message:"La contraseña debe tener entre 8 y 20 caracteres"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row"})}}),t.querySelector("#kt_signin_submit").addEventListener("click",(function(o){o.preventDefault(),msgLoad("Procesando...");let a=new FormData(t);a.append("usuario",document.querySelector("#session_usuario_id").value),a.append("usuario_rol",document.querySelector("#session_rol_id ").value),a.append("id",document.querySelector("input[name='hd_id']").value),e.validate().then((function(o){"Valid"==o?fetch(`${environment.apiSRD}/API/admin/actualizar-datos`,{method:"POST",body:a}).then((e=>e.json())).then((o=>{1==o.estado?(t.reset(),e.resetForm(),p(),_(),msgSuccessMixin("Los cambios han sido guardados exitosamente","")):msgError(ErrorMensaje(o),(()=>{2==o.estado&&location.reload()}),(()=>{2==o.estado&&location.reload()}))})):msgError("Hay campos pendientes de validación, por favor revise el formulario.",(()=>{}),(()=>{}))}))})))}(),function(){var e;o&&(e=FormValidation.formValidation(o,{fields:{password1:{validators:{notEmpty:{message:"La contraseña actual es obligatoria"}}},password2:{validators:{notEmpty:{message:"La nueva contraseña es obligatoria"}}},confirmpassword:{validators:{notEmpty:{message:"La confirmación de la contraseña es obligatoria"},identical:{compare:function(){return o.querySelector('[name="password2"]').value},message:"La contraseña y su confirmación no son iguales"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row"})}}),o.querySelector("#kt_password_submit").addEventListener("click",(function(t){t.preventDefault();let a=new FormData(o);a.append("usuario",document.querySelector("#session_usuario_id").value),a.append("usuario_rol",document.querySelector("#session_rol_id ").value),a.append("id",document.querySelector("input[name='hd_id']").value),e.validate().then((function(t){"Valid"==t?fetch(`${environment.apiSRD}/API/admin/actualizar-datos`,{method:"POST",body:a}).then((e=>e.json())).then((t=>{1==t.estado?swal.fire({text:"Se ha actualizado el usuario correctamente",icon:"success",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn font-weight-bold btn-light-primary"}}).then((function(){o.reset(),e.resetForm(),v(),_()})):msgError(ErrorMensaje(t),(()=>{2==t.estado&&location.reload()}),(()=>{2==t.estado&&location.reload()}))})):msgError("Hay campos pendientes de validación, por favor revise el formulario.",(()=>{}),(()=>{}))}))})))}(),function(){var e;e=FormValidation.formValidation(n,{fields:{deactivate:{validators:{notEmpty:{message:"Tiene que aceptar para continuar"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,submitButton:new FormValidation.plugins.SubmitButton,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),g.addEventListener("click",(function(t){t.preventDefault();let a=new FormData;a.append("estado",1==document.querySelector("input[name='estado']").value?0:1),a.append("usuario",document.querySelector("#session_usuario_id").value),a.append("usuario_rol",document.querySelector("#session_rol_id ").value),a.append("id",document.querySelector("input[name='hd_id']").value),e.validate().then((function(t){"Valid"==t?fetch(`${environment.apiSRD}/API/admin/actualizar-datos`,{method:"POST",body:a}).then((e=>e.json())).then((t=>{1==t.estado?swal.fire({text:"Se ha actualizado el usuario correctamente",icon:"success",buttonsStyling:!1,confirmButtonText:"Entendido",customClass:{confirmButton:"btn font-weight-bold btn-light-primary"}}).then((function(){o.reset(),e.resetForm(),_()})):msgError(ErrorMensaje(t),(()=>{2==t.estado&&location.reload()}),(()=>{2==t.estado&&location.reload()}))})):msgError("Hay campos pendientes de validación, por favor revise el formulario.",(()=>{}),(()=>{}))}))}))}(),e.querySelector("#btn_img_guardar").addEventListener("click",(function(t){t.preventDefault(),msgLoad("Procesando...");let o=new FormData(e);o.append("estado",1),o.append("usuario",document.querySelector("#session_usuario_id").value),o.append("usuario_rol",document.querySelector("#session_rol_id ").value),o.append("id",document.querySelector("input[name='hd_id']").value),fetch(`${environment.apiSRD}/API/admin/actualizar-datos`,{method:"POST",body:o}).then((e=>e.json())).then((t=>{1==t.estado?(e.reset(),_(),msgSuccess("Los cambios han sido guardados exitosamente")):msgError(ErrorMensaje(t),(()=>{2==t.estado&&location.reload()}),(()=>{2==t.estado&&location.reload()}))}))})))}}}();KTUtil.onDOMContentLoaded((function(){KTPerfil.init()}));var optionFormat=function(e){if(!e.id)return e.text;var t=document.createElement("span"),o="";return o+='<img src="'+e.element.getAttribute("data-kt-select2-pais")+'" class="rounded-circle h-20px me-2" alt="image"/>',o+=e.text,t.innerHTML=o,$(t)};